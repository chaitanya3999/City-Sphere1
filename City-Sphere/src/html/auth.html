<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>City Sphere - Authentication</title>
    <link rel="manifest" href="../manifest.json" />
    <meta name="theme-color" content="#0066CC" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <link rel="stylesheet" href="../css/home.css" />
    <link rel="stylesheet" href="../css/navigation.css" />
    <link rel="stylesheet" href="../css/auth-new.css" />
    <link rel="stylesheet" href="../css/chatbot.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    
    <!-- Google Sign-In API -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <!-- JWT Decode Library -->
    <script src="https://unpkg.com/jwt-decode/build/jwt-decode.js"></script>
    
    <!-- Facebook SDK -->
    <script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js"></script>
  </head>
  <body>
    <!-- Existing Header from other pages -->
    <header>
      <div class="top-header">
        <div class="container">
          <div class="logo-container">
            <div class="logo-circle">
              <img
                src="../images/City Sphere Final copy.png"
                alt="City Sphere Logo"
                class="logo-image"
              />
            </div>
            <div class="logo-text">
              <h1>City Sphere</h1>
              <p class="tagline">My City in My Phone</p>
            </div>
          </div>
        </div>
      </div>
      <nav class="navbar">
        <div class="container">
          <div class="nav-wrapper">
            <ul class="nav-links">
              <li>
                <a href="index.html"><i class="fas fa-home"></i>Home</a>
              </li>
              <li>
                <a href="services.html"><i class="fas fa-cogs"></i>Services</a>
              </li>
              <li>
                <a href="aboutus.html"><i class="fas fa-users"></i>About Us</a>
              </li>
              <li>
                <a href="contact.html"
                  ><i class="fas fa-envelope"></i>Contact</a
                >
              </li>
            </ul>
            <div class="nav-buttons">
              <a href="wallet.html" class="btn btn-wallet">
                <i class="fas fa-wallet"></i>Wallet
              </a>
              <a href="auth.html" class="btn btn-login">
                <i class="fas fa-user"></i>Login
              </a>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="auth-container">
      <div class="auth-wrapper">
        <div class="auth-form-container">
          <div class="auth-tabs">
            <button class="tab-btn active" data-form="login">
              <i class="fas fa-sign-in-alt"></i> Login
            </button>
            <button class="tab-btn" data-form="signup">
              <i class="fas fa-user-plus"></i> Sign Up
            </button>
          </div>

          <form id="loginForm" class="auth-form active">
            <h2>Welcome Back!</h2>
            <p class="form-description">
              Sign in to access your City Sphere account
            </p>

            <div class="form-group">
              <label for="loginEmail">Email Address</label>
              <input
                type="email"
                id="loginEmail"
                name="email"
                required
                placeholder="Enter your email"
              />
              <i class="fas fa-envelope input-icon"></i>
            </div>

            <div class="form-group password-group">
              <label for="loginPassword">Password</label>
              <input
                type="password"
                id="loginPassword"
                name="password"
                required
                placeholder="Enter your password"
              />
              <i class="fas fa-lock input-icon"></i>
              <button
                type="button"
                class="password-toggle"
                aria-label="Toggle password visibility"
              >
                <i class="fas fa-eye-slash"></i>
              </button>
            </div>

            <div class="form-options">
              <label class="checkbox-container">
                <input type="checkbox" name="remember" />
                <span class="checkmark"></span>
                Remember me
              </label>
              <a href="#" class="forgot-password">Forgot Password?</a>
            </div>

            <button type="submit" class="btn-submit">Login</button>

            <div class="social-login">
              <p>Or continue with</p>
              <div class="social-buttons">
                <!-- Google Sign-In Button -->
                <div id="g_id_onload"
                     data-client_id="855437139826-iuond0b1id6a7tuh2vlh9bv69kh88r6a.apps.googleusercontent.com"
                     data-callback="handleGoogleSignIn"
                     data-auto_select="false"
                     data-itp_support="true">
                </div>
                <div class="g_id_signin"
                     data-type="standard"
                     data-size="large"
                     data-theme="outline"
                     data-text="sign_in_with"
                     data-shape="rectangular"
                     data-width="280">
                </div>

                <!-- Facebook Login Button -->
                <button type="button" class="btn-social facebook" onclick="handleFacebookLogin()">
                  <i class="fab fa-facebook-f"></i>
                  <span>Sign in with Facebook</span>
                </button>
              </div>
            </div>
          </form>

          <form id="signupForm" class="auth-form">
            <h2>Create Account</h2>
            <p class="form-description">
              Join City Sphere and access city services
            </p>

            <div class="form-group">
              <label for="signupName">Full Name</label>
              <input
                type="text"
                id="signupName"
                name="name"
                required
                placeholder="Enter your full name"
              />
              <i class="fas fa-user input-icon"></i>
            </div>

            <div class="form-group">
              <label for="signupEmail">Email Address</label>
              <input
                type="email"
                id="signupEmail"
                name="email"
                required
                placeholder="Enter your email"
              />
              <i class="fas fa-envelope input-icon"></i>
            </div>

            <div class="form-group">
              <label for="signupPhone">Phone Number</label>
              <input
                type="tel"
                id="signupPhone"
                name="phone"
                required
                placeholder="Enter your phone number"
              />
              <i class="fas fa-phone input-icon"></i>
            </div>

            <div class="form-group password-group">
              <label for="signupPassword">Password</label>
              <input
                type="password"
                id="signupPassword"
                name="password"
                required
                placeholder="Create a strong password"
              />
              <i class="fas fa-lock input-icon"></i>
              <button
                type="button"
                class="password-toggle"
                aria-label="Toggle password visibility"
              >
                <i class="fas fa-eye-slash"></i>
              </button>
              <div class="password-strength-meter"></div>
            </div>

            <div class="form-group password-group">
              <label for="confirmPassword">Confirm Password</label>
              <input
                type="password"
                id="confirmPassword"
                name="confirm-password"
                required
                placeholder="Confirm your password"
              />
              <i class="fas fa-lock input-icon"></i>
            </div>

            <div class="form-group">
              <label class="checkbox-container">
                <input type="checkbox" name="terms" required />
                <span class="checkmark"></span>
                I agree to the Terms of Service and Privacy Policy
              </label>
            </div>

            <button type="submit" class="btn-submit">Create Account</button>

            <div class="social-login">
              <p>Or continue with</p>
              <div class="social-buttons">
                <!-- Google Sign-In Button -->
                <div id="g_id_onload"
                     data-client_id="855437139826-iuond0b1id6a7tuh2vlh9bv69kh88r6a.apps.googleusercontent.com"
                     data-callback="handleGoogleSignIn"
                     data-auto_select="false"
                     data-itp_support="true">
                </div>
                <div class="g_id_signin"
                     data-type="standard"
                     data-size="large"
                     data-theme="outline"
                     data-text="continue_with"
                     data-shape="rectangular"
                     data-logo_alignment="left">
                </div>

                <!-- Facebook Login Button -->
                <button type="button" class="btn-social facebook" onclick="handleFacebookLogin()">
                  <i class="fab fa-facebook-f"></i> Continue with Facebook
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </main>

    <!-- Existing Footer from other pages -->
    <footer>
      <div class="container">
        <div class="footer-content">
          <div class="footer-section">
            <h3>About City Sphere</h3>
            <p>Connecting citizens with city services seamlessly.</p>
          </div>
          <div class="footer-section">
            <h3>Quick Links</h3>
            <ul>
              <li><a href="index.html">Home</a></li>
              <li><a href="services.html">Services</a></li>
              <li><a href="contact.html">Contact</a></li>
              <li><a href="aboutus.html">About Us</a></li>
              <li><a href="emergency-services.html">Emergency Services</a></li>
            </ul>
          </div>
          <div class="footer-section">
            <h3>Connect With Us</h3>
            <div class="social-icons">
              <a href="#"><i class="fab fa-facebook"></i></a>
              <a href="#"><i class="fab fa-twitter"></i></a>
              <a href="#"><i class="fab fa-instagram"></i></a>
              <a href="#"><i class="fab fa-linkedin"></i></a>
            </div>
          </div>
        </div>
        <div class="footer-bottom">
          <p>
            &copy; 2024 City Sphere. All Rights Reserved.
            <a
              href="../resources/Privecy Policy.pdf"
              style="color: white; margin-left: 15px"
              target="_blank"
              >Privacy Policy</a
            >
          </p>
        </div>
      </div>
    </footer>

    <script type="module" src="../js/auth-new.js"></script>
    <script type="module" src="../js/signup-validation.js"></script>
    <script type="module" src="../js/custom-auth.js"></script>
    <script src="../js/chatbot.js"></script>

    <script>
      // Handle Google Sign-In
      function handleGoogleSignIn(response) {
        if (response.credential) {
          // Decode the credential
          const decoded = jwt_decode(response.credential);
          console.log('Google Sign-In successful:', decoded);
          
          // Handle the sign-in
          handleSocialLogin('google', {
            id: decoded.sub,
            name: decoded.name,
            email: decoded.email,
            picture: decoded.picture
          });
        } else {
          console.error('Google Sign-In failed:', response);
        }
      }

      // Handle Facebook Login
      function handleFacebookLogin() {
        FB.login(function(response) {
          if (response.authResponse) {
            console.log('Facebook login successful');
            FB.api('/me', { fields: 'id,name,email,picture' }, function(userData) {
              console.log('Facebook user data:', userData);
              handleSocialLogin('facebook', userData);
            });
          } else {
            console.error('Facebook login failed:', response);
          }
        }, { scope: 'email,public_profile' });
      }

      // Initialize Facebook SDK
      window.fbAsyncInit = function() {
        FB.init({
          appId: '631781262866181',
          cookie: true,
          xfbml: true,
          version: 'v18.0'
        });
      };

      // Common function to handle social login
      function handleSocialLogin(provider, userData) {
        console.log(`${provider} login:`, userData);
        
        // Here you can either:
        // 1. Store the user data in localStorage/sessionStorage
        sessionStorage.setItem('user', JSON.stringify({
          provider: provider,
          ...userData
        }));
        
        // 2. Redirect to dashboard
        window.location.href = 'user-dashboard.html';
      }
    </script>
  </body>
</html>